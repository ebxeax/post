# Cache和主存的映射
Cache行中的信息是主存某个块的副本  
地址映射：将主存地址空间映射到Cache地址空间，按某种规则将主存的信息装入Cache  
Cache的行数比主存块少的多，只有一部分主存块的信息可以装入Cache中，因此在Cache中需要为每块加一个**标记**，指明它是主存的哪一块的副本，此标记相当于主存块的编号。为了说明Cache行中的信息是否有效还需要一个**有效位**，地址映射以下3种：
- 直接映射
- 全相联映射
- 组相联映射

## 直接映射
Cache 行号 = 主存块号 mod Cache 总行数  
假设 Cache : $2^c$行 主存 : $2^m$块  
$0,2^c,2^{c+1},\dots$块映射到第0行  
$1,2^c+1,2^{c+1}+1$块映射到第1行  
低c位为装入的Cache行号，给每行设置一个长为t=m-c的标记，当某个主存块调入Cache后，将主存块号的高t位设置为对应Cache行中的标记  
|t|c|b|
|-|-|-|
|标记|Cache行号|块内地址|  

CPU访存过程：
- 根据访存地址中间的c位找到对应Cache行
- Cache行标记与主存地址高t位标记比较，确定是否有效
- 相等且有效位为1，访问Cache命中，根据主存地址低b位的块内地址，在对应Cache行中存取信息
- 不相等或有效位为0，不命中，CPU将主存读出该地址所在的一块信息送到相应的Cache行中，置有效位1，并将标记设置为地址高t位，同时将地址中的内容送CPU

## 全相联映射
主存的每一块可以装入Cache中的任何位置，每行**标记**用于指出该行取自主存的哪一块，CPU访存时需要与所有Cache行的标记进行对比  
|t|b|
|-|-|
|标记|块内地址|

## 组相联映射
